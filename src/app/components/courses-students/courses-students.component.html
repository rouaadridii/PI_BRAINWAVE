<body>
    <app-front-header></app-front-header>
  
    <div class="container-fluid list-cours-container">
      <div class="filters-bar mb-3">
        <div class="search-bar">  <div class="input-group search-container">
            <input
              type="text"
              class="form-control search-input"
              placeholder="Rechercher un cours par titre..."
              [(ngModel)]="searchQuery"
              (input)="onSearchInput()"  (focus)="showSuggestions = true" (blur)="onSearchBlur()"       (keydown.escape)="hideSuggestionsList()" />
            <ul class="suggestions-list" *ngIf="showSuggestions && suggestions.length > 0"
                (mouseenter)="onMouseEnterSuggestions()" (mouseleave)="onMouseLeaveSuggestions()" >
              <li
                *ngFor="let suggestion of suggestions"
                (click)="selectSuggestion(suggestion)"
                (mouseenter)="highlightSuggestion(suggestion)"
                [class.highlighted]="highlightedSuggestion === suggestion"
              >
                {{ suggestion.title }}
              </li>
            </ul>
            <button class="btn mic-btn" type="button" (click)="startSpeechRecognition()">
              <i class="fa fa-microphone mic-icon"></i>
            </button>
            <button class="btn-ai mt-2" (click)="textToSpeech()">
              <span class="icon">
                <i class="fas fa-robot"></i>
              </span>
              <span class="text">
                {{ isSpeaking ? 'Arrêter la lecture' : 'Lire avec IA' }}
              </span>
            </button>
          </div>
        </div>  <div class="category-filters mt-3">
          <button
            class="btn category-btn"
            [ngClass]="{ active: selectedCategory === 'all' }"
            (click)="onCategoryButtonClick('all')"
          >
            ALL COURSES
          </button>
          <button
            class="btn category-btn"
            [ngClass]="{ active: selectedCategory === 'favorites' }"
            (click)="onCategoryButtonClick('favorites')"
          >
            FAVORITES COURSES
          </button>
          <button
            class="btn category-btn"
            [ngClass]="{ active: selectedCategory === 'soon' }"
            (click)="onCategoryButtonClick('soon')"
          >
            SOON
          </button>
          <button
            class="btn category-btn"
            [ngClass]="{ active: selectedCategory === 'important' }"
            (click)="onCategoryButtonClick('important')"
          >
            IMPORTANT
          </button>
          <button
            class="btn category-btn"
            class="btn category-btn"
            [ngClass]="{ active: selectedCategory === 'attractive' }"
            (click)="onCategoryButtonClick('attractive')"
          >
            ATTRACTIVE
          </button>
        </div>
      </div>
  
      <div
        *ngIf="courses.length > 0; else noCourses"
        class="row row-cols-1 row-cols-md-3 g-4"
      >
        <div
          *ngFor="let course of getPaginatedCourses(); let i = index"
          class="col"
          [attr.id]="'course-' + course.idCourse"
        >
          <div class="card course-card shadow-lg border-0 rounded h-100">
            <img
              [src]="
                course.picture
                  ? course.picture.startsWith('http')
                    ? course.picture
                    : 'http://localhost:8087/cours/courses/download-image/' +
                      course.picture
                  : 'assets/default-image.jpg'
              "
              class="card-img-top course-image rounded-top"
              alt="Image du cours"
            />
            <div class="card-body d-flex flex-column">
              <div
                class="course-header d-flex justify-content-between align-items-center mb-2"
              >
                <span class="course-price badge bg-primary rounded-pill"
                  >${{ course.price | number: '1.2-2' }}</span
                >
                <span
                  class="course-category badge bg-light text-secondary rounded-pill"
                  >{{ course.categorie }}</span
                >
              </div>
              <h5 class="card-title course-title text-dark mb-2">
                {{ course.title }}
              </h5>
              <p class="card-text course-description text-muted flex-grow-1">
                {{ course.description || 'Description non disponible' }}
              </p>
              <ul class="list-unstyled course-details-list mb-3">
                <li>
                  <i class="fas fa-calendar-alt detail-icon"></i> Date :
                  <div class="course-date-formatted">
                    <span class="course-date-month"
                      >{{ course.date | date: 'MMM' | uppercase }}</span
                    >
                    <span class="course-date-day">{{
                      course.date | date: 'd'
                    }}</span>
                  </div>
                </li>
                <li>
                  <i class="fas fa-check-circle detail-icon"></i> Status :
                  <span
                    [ngClass]="{
                      'text-success': course.status,
                      'text-danger': !course.status
                    }"
                  >
                    {{ course.status ? 'Disponible' : 'Indisponible' }}
                  </span>
                </li>
              </ul>
              <div
                class="course-actions d-flex justify-content-between align-items-center"
              >
                <div class="favorite-button">
                  <i
                    class="fa fa-heart"
                    [class.text-danger]="course.liked"
                    (click)="toggleFavorite(course)"
                    style="cursor: pointer;"
                  ></i>
                </div>
  
                <div class="rating-stars">
                     <span class="average-rating">
                        {{ averageRating[course.idCourse] | number: '1.1-1' }}
                        <i class="fa fa-star star-icon"></i>
                    </span>
                </div>
  
                <div class="action-buttons">
                  <a
                    [routerLink]="['/course-detail', course.idCourse]"
                    class="btn btn-sm btn-outline-primary"
                    >Voir Détails</a
                  >
                  <button class="btn btn-sm btn-outline-info" (click)="openReviewForm(course.idCourse)">
                    Review
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  
      <ng-template #noCourses>
        <div class="alert alert-warning text-center mt-4" role="alert">
          Aucun cours disponible.
        </div>
      </ng-template>
  
      <div class="pagination-container mt-4 d-flex justify-content-center align-items-center">
        <button class="btn pagination-btn prev-btn" (click)="previousPage()" [disabled]="currentPage === 1">
          <i class="fas fa-chevron-left"></i> Précédent
        </button>
  
        <div class="page-numbers d-flex align-items-center mx-3">
          <button
            *ngFor="let page of getPagesArray()"
            class="btn pagination-btn page-number-btn"
            [ngClass]="{'active': currentPage === page}"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
        </div>
  
        <button class="btn pagination-btn next-btn" (click)="nextPage()" [disabled]="currentPage === totalPages() || totalPages() === 0">
          Suivant <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
  
    
  
    <div *ngIf="isReviewFormVisible" class="review-form-popup">
      <div class="review-form-content">
        <h3>Laissez votre avis</h3>
        <p class="text-muted">Les avis sont publics et incluent des informations sur votre compte.</p>
  
        <div class="stars">
          <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
            <i
              class="fa fa-star"
              [ngClass]="{'active': star <= reviewRating}"
              (mouseenter)="hoverReviewRating(star)"
              (mouseleave)="hoverReviewRating(0)"
              (click)="reviewRating = star"
              [title]="'Donner ' + star + ' étoiles'"
            >
            </i>
          </ng-container>
             <span class="current-rating-value ms-2">({{ reviewRating || 0 }})</span>
        </div>
  
        <div class="mb-3">
          <label for="reviewComment" class="form-label">Décrivez votre expérience (facultatif):</label>
          <textarea class="form-control" id="reviewComment" rows="3" [(ngModel)]="reviewComment" maxlength="500"></textarea>
        </div>
  
        <div class="form-buttons">
          <button class="btn btn-primary" (click)="submitReview()">Publier</button>
          <button class="btn btn-secondary" (click)="closeReviewForm()">Terminer</button>
        </div>
      </div>
    </div>
  
    <app-front-footer></app-front-footer>
  </body>