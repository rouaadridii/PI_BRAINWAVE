<app-front-header></app-front-header>
<div class="main-content">
    <div class="filter-buttons">
        <button class="btn btn-filter" [class.active]="filter === 'all'" (click)="setFilter('all')">All Courses</button>
        <button class="btn btn-filter" [class.active]="filter === 'favorites'" (click)="setFilter('favorites')">
            <i class="fa fa-heart"></i> Favorites
        </button>
    </div>
    <div class="search-bar me-3">
        <div class="input-group search-container">
            <input
                type="text"
                class="form-control search-input"
                placeholder="Rechercher un cours par titre..."
                [(ngModel)]="searchQuery"
                (input)="onSearchInput()"
                (focus)="showSuggestions = true"
                (blur)="onSearchBlur()"
                (keydown.escape)="hideSuggestionsList()"
             />
            <ul class="suggestions-list" *ngIf="showSuggestions && suggestions.length > 0"
                (mouseenter)="onMouseEnterSuggestions()" (mouseleave)="onMouseLeaveSuggestions()">
                <li
                    *ngFor="let suggestion of suggestions"
                    (click)="selectSuggestion(suggestion)"
                    (mouseenter)="highlightSuggestion(suggestion)"
                    [class.highlighted]="highlightedSuggestion === suggestion"
                >
                    {{ suggestion.title }}
                </li>
            </ul>
            <span class="input-group-text" (click)="startSpeechRecognition()" id="basic-addon1">
                <i class="fa fa-microphone"></i>
            </span>
        </div>
    </div>

    <div class="d-flex align-items-center">
      <div class="price-range-filter me-3">
          <label for="priceRange" class="form-label fw-bold">Filtrer par prix :</label>
          <select id="priceRange" class="form-select border-primary rounded-pill" [(ngModel)]="selectedPriceRange" (change)="onPriceRangeChange(selectedPriceRange)">
              <option value="all">Tous les prix</option>
              <option value="free">Gratuit</option>
              <option value="under50">Moins de $50</option>
              <option value="50to100">$50 - $100</option>
              <option value="above100">Plus de $100</option>
          </select>
      </div>

      <div class="sorting-options me-3">
          <label for="sortOption" class="form-label fw-bold">Trier par :</label>
          <select id="sortOption" class="form-select border-primary rounded-pill" [(ngModel)]="sortOption" (change)="onSortOptionChange(sortOption)">
              <option value="default">Par défaut</option>
              <option value="priceAsc">Prix croissant</option>
              <option value="priceDesc">Prix décroissant</option>
              <option value="popularity">Popularité</option>
              <option value="rating">Note</option>
          </select>
      </div>
  </div>
</div>

    <div
        *ngIf="filteredCourses.length > 0; else noCourses"
        class="row row-cols-1 row-cols-md-3 g-4" id="courses-list"
    >
    <div *ngFor="let course of paginatedCourses()" class="col" [id]="'course-' + course.idCourse" [class.animate-up]="course.animateUp">

        <div class="card h-100 shadow-lg border-0 rounded overflow-hidden course-card">
          <div class="card-img-top position-relative">
            <img
              [src]="
                course.picture
                  ? 'http://localhost:8087/cours/courses/images/' + course.picture
                  : 'assets/default-image.jpg'
              "
              alt="Image du cours"
              class="w-100 course-image"
            />
              <span class="course-status-badge" [ngClass]="{'available': course.status, 'unavailable': !course.status}">
                {{ course.status ? 'Disponible' : 'Indisponible' }}
              </span>
          </div>

          <div class="card-body d-flex flex-column">
            <div class="course-header">
              <span class="course-price">{{ course.price | currency }}</span>
              <span class="course-category">{{ course.category }}</span>
              <ng-container *ngIf="averageRating[course.idCourse] !== undefined">
                <span class="course-rating">
                  {{ averageRating[course.idCourse] }}
                  <i class="fa fa-star text-warning"></i>
                </span>
              </ng-container>
              <button class="btn btn-outline-secondary btn-sm btn-ia" (click)="textToSpeech(course)">
                <i class="fas fa-volume-up"></i>
                {{ course.isSpeaking ? 'Arrêter' : 'Lire' }}
              </button>
            </div>

            <h5 class="card-title">{{ course.title }}</h5>
            <p class="card-text course-description">
              {{ course.description || 'Aucune description disponible' }}
            </p>

            <div class="course-details">
                <div class="course-date-formatted">
                    <span class="course-date-month">{{ course.date | date: 'MMM' | uppercase }}</span>
                    <span class="course-date-day">{{ course.date | date: 'd' }}</span>
                </div>
                <div class="course-info">
                    <span class="course-level"
                  >Niveau: {{ course.level }}</span
                >
                </div>
              </div>

            <div class="mt-auto d-flex justify-content-between align-items-center">
              <a
                [routerLink]="['/details', course.idCourse]"
                class="btn btn-primary btn-details"
              >
                <i class="fas fa-eye"></i> Détails
              </a>
             <button *ngIf="!course.liked" (click)="toggleFavorite(course)" class="btn btn-outline-danger btn-favorite">
                <i class="fa fa-heart" [class.text-danger]="course.liked"></i>
             </button>
             <button *ngIf="course.liked" (click)="toggleFavorite(course)" class="btn btn-outline-danger btn-favorite">
                <i class="fa fa-heart text-danger"></i>  </button>

            </div>
          </div>
        </div>
      </div>
    </div>

    <nav class="d-flex justify-content-center mt-4 pagination-container">
      <ul class="pagination">
        <li class="page-item" [class.disabled]="currentPage === 1">
          <a
            class="page-link pagination-btn prev-btn"
            (click)="prevPage()"
            aria-label="Précédent"
          >
            &laquo;
          </a>
        </li>

        <li
          *ngFor="let page of getPages()"
          class="page-item"
          [class.active]="page === currentPage"
        >
          <a class="page-link pagination-btn page-number-btn" (click)="goToPage(page)"
            >{{ page }}</a
          >
        </li>

        <li
          class="page-item"
          [class.disabled]="currentPage >= totalPages()"
        >
          <a
            class="page-link pagination-btn next-btn"
            (click)="nextPage()"
            aria-label="Suivant"
          >
            &raquo;
          </a>
        </li>
      </ul>
    </nav>

    <ng-template #noCourses>
      <div class="alert alert-warning text-center">Aucun cours trouvé.</div>
    </ng-template>
<app-front-footer></app-front-footer>