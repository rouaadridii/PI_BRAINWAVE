<!-- Affichage du champ de recherche avec microphone -->
<div class="input-group mb-3">
  <div class="input-group search-container">
      <!-- Champ de recherche -->
      <input type="text" class="form-control search-input" placeholder="Rechercher un cours..." [(ngModel)]="searchQuery" (input)="searchCourses()">
  
      <!-- Bouton microphone avec effet dynamique -->
      <button class="btn mic-btn" type="button" (click)="startSpeechRecognition()">
          <i class="fa fa-microphone mic-icon"></i>
      </button>
      <button class="btn-ai mt-2" (click)="textToSpeech()">
          <span class="icon">
              <i class="fas fa-robot"></i>
          </span>
          <span class="text">
              {{ isSpeaking ? 'Arrêter la lecture' : 'Lire avec IA' }}
          </span>
      </button>
  </div>
</div>

<!-- Affichage du formulaire de mise à jour si un cours est sélectionné -->
<div *ngIf="selectedCourse; else coursesList">
  <div class="card shadow-lg border-light rounded">
      <div class="card-body">
          <h5 class="card-title">Modifier le cours : {{ selectedCourse.title }}</h5>
          <form (ngSubmit)="updateCourse()">
              <div class="form-group">
                  <label for="title">Titre</label>
                  <input type="text" id="title" [(ngModel)]="selectedCourse.title" name="title" class="form-control" required>
              </div>

              <div class="form-group">
                  <label for="description">Description</label>
                  <input type="text" id="description" [(ngModel)]="selectedCourse.description" name="description" class="form-control" required>
              </div>

              <div class="form-group">
                  <label for="price">Prix</label>
                  <input type="number" id="price" [(ngModel)]="selectedCourse.price" name="price" class="form-control" required>
              </div>
                <!-- Upload Image -->
        <div class="mb-3">
          <label for="picture" class="form-label">Image :</label>
          <input type="file" id="picture" class="form-control" (change)="onFileSelected($event)">
        </div>

              <!-- Catégorie -->
              <div class="mb-3">
                  <label for="categorie" class="form-label">Catégorie :</label>
                  <select id="categorie" class="form-select" formControlName="categorie" required>
                      <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
                  </select>
              </div>

              <!-- Niveau -->
              <div class="mb-3">
                  <label for="level" class="form-label">Niveau :</label>
                  <select id="level" class="form-select" [(ngModel)]="selectedCourse.level" name="level" required>
                      <option value="Débutant">Débutant</option>
                      <option value="Intermédiaire">Intermédiaire</option>
                      <option value="Avancé">Avancé</option>
                  </select>
              </div>

              





              

              <button type="submit" class="btn btn-primary mt-2">Mettre à jour</button>
              <button type="button" class="btn btn-secondary mt-2" (click)="cancelUpdate()">Annuler</button>
          </form>
      </div>
  </div>
</div>







<!-- Affichage de la liste des cours -->
<ng-template #coursesList>
  <div *ngIf="courses.length > 0; else noCourses">
      <div class="row row-cols-1 row-cols-md-3 g-4">
          <div *ngFor="let course of sortedCourses(); let i = index" class="col" [attr.id]="'course-' + course.idCourse">
              <div class="card shadow-lg border-light rounded">
                  <!-- Image du cours -->
                  <img 
                      [src]="course.picture ? 'http://localhost:8087/cours/courses/download-image/' + course.picture : 'assets/default-image.jpg'" 
                      class="card-img-top" 
                      alt="Image du cours" 
                      style="height: 200px; object-fit: cover;">
                  
                  <div class="card-body">
                      <!-- Titre du cours -->
                      <h5 class="card-title text-dark">{{ course.title }}</h5>
                      <!-- Description du cours -->
                      <p class="card-text text-muted">{{ course.description || 'Description non disponible' }}</p>
                       <ul class="list-unstyled">
                          <li><strong>Date :</strong> {{ course.date | date: 'shortDate' }}</li>
                          <li><strong>Catégorie :</strong> {{ course.categorie }}</li>
                          <li><strong>Prix :</strong> {{ course.price | currency }}</li>
                          <li><strong>Niveau :</strong> {{ course.level }}</li>
                          <li><strong>Status :</strong> 
                              <span [ngClass]="{'text-success': course.status, 'text-danger': !course.status}">
                                  {{ course.status ? 'Disponible' : 'Indisponible' }}
                              </span>
                          </li>
                      </ul>

                      

                      <div *ngFor="let course of courses">
                        <h3>{{ course.title }}</h3>
                      
                        <!-- Système de notation -->
                        <div class="rating">
                          <i *ngFor="let star of [1,2,3,4,5]; let i = index"
                             class="fa"
                             [ngClass]="course.rating >= star ? 'fa-star' : 'fa-star-o'"
                             (click)="rateCourse(course.idCourse, star)">
                          </i>
                        </div>
                      </div>
                      
                      

                      <!-- Lien vers les détails du cours -->
                      <a [routerLink]="['/course-detail', course.idCourse]" class="btn btn-primary mt-2">Voir Détails</a>

                      <!-- Bouton pour modifier -->
                      <button class="btn btn-warning mt-2" (click)="selectCourse(course)">Modifier</button>

                      <!-- Bouton pour supprimer -->
                      <button class="btn btn-danger mt-2" (click)="confirmerEtSupprimerCours(course)">Supprimer</button>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Message affiché si aucun cours n'est disponible -->
  <ng-template #noCourses>
      <div class="alert alert-warning text-center mt-4" role="alert">
          Aucun cours disponible.
      </div>
  </ng-template>
</ng-template>